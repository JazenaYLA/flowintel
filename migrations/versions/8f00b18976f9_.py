"""empty message

Revision ID: 8f00b18976f9
Revises: 6a9a28d9fb7a
Create Date: 2025-01-29 11:18:06.561242

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy import inspect
from sqlalchemy.exc import OperationalError


# revision identifiers, used by Alembic.
revision = '8f00b18976f9'
down_revision = '6a9a28d9fb7a'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    bind = op.get_bind()
    inspector = inspect(bind)
    
    # Drop taxonomies and add is_private to case
    case_columns = [col['name'] for col in inspector.get_columns('case')]
    if 'taxonomies' in case_columns:
        op.drop_column('case', 'taxonomies')
    if 'is_private' not in case_columns:
        op.add_column('case', sa.Column('is_private', sa.Boolean(), nullable=True))

    # Drop taxonomies from case__template
    case_template_columns = [col['name'] for col in inspector.get_columns('case__template')]
    if 'taxonomies' in case_template_columns:
        op.drop_column('case__template', 'taxonomies')

    # Drop taxonomies from task
    task_columns = [col['name'] for col in inspector.get_columns('task')]
    if 'taxonomies' in task_columns:
        op.drop_column('task', 'taxonomies')

    # Drop taxonomies from task__template
    task_template_columns = [col['name'] for col in inspector.get_columns('task__template')]
    if 'taxonomies' in task_template_columns:
        op.drop_column('task__template', 'taxonomies')

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    bind = op.get_bind()
    inspector = inspect(bind)
    case_columns = [col['name'] for col in inspector.get_columns('case')]
    
    if 'is_private' in case_columns:
        op.drop_column('case', 'is_private')

    # ### end Alembic commands ###
